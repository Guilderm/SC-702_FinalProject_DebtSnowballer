@using MudBlazor
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@inject NavigationManager NavigationManager
@inject SignOutSessionStateManager SignOutManager

@inherits LayoutComponentBase

<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>

<CascadingAuthenticationState>
	<MudLayout>
		<MudAppBar Elevation="1">
			<MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@((e) => DrawerToggle())" />
			<MudText Typo="Typo.h5" Class="ml-3">Debt Snowballer</MudText>
			<MudSpacer />
			<AuthenticationStatus />

			<MudMenu Icon="@Icons.Material.Filled.MoreVert" Color="Color.Inherit">
				<MudMenuItem OnClick="NavigateToProfile">Profile</MudMenuItem>
				<MudMenuItem OnClick="BeginSignOut">Log out</MudMenuItem>
			</MudMenu>
			
		</MudAppBar>
		<MudDrawer @bind-Open="_drawerOpen" ClipMode="DrawerClipMode.Always" Elevation="2">
			<NavMenu/>
		</MudDrawer>
		<MudMainContent>
			@Body
		</MudMainContent>
	</MudLayout>
</CascadingAuthenticationState>

@code {

	bool _drawerOpen = true;
	bool _profileMenuOpen = false;

	void DrawerToggle()
	{
		_drawerOpen = !_drawerOpen;
	}

	void ToggleProfileMenu()
	{
		_profileMenuOpen = !_profileMenuOpen;
	}

	void NavigateToProfile()
	{
		NavigationManager.NavigateTo("/Profile");
	}

	async Task BeginSignOut()
	{
		await SignOutManager.SetSignOutState();
		NavigationManager.NavigateTo("authentication/logout");
	}
}