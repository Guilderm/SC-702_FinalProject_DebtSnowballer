@using DebtSnowballer.Shared.DTOs
@using DebtSnowballer.Shared.Currency
@inject ISnackbar Snackbar
@inject IDialogService DialogService

@inject ILogger<DebtTable> Logger

<br>
<br>

<h3>Select your base currency</h3>
<p>SupportedCurrencies loans will be converted to your base currency. SupportedCurrencies calculations and reports will also be made using this currency.</p>
<br>
@if (UserPreference == null)
{
	<p>
		<em>Loading strategies...</em>
		<MudProgressLinear Color="Color.Primary" Striped="true" Size="Size.Large" Value="75" Class="my-7"/>
	</p>
}
else
{
	<MudSelect T="string" Label="Select Currency" Value="UserPreference.BaseCurrency" Variant="Variant.Text" ValueChanged="SavePreferredBaseCurrency">
		@foreach (CurrencyInfo currency in Currencies.SupportedCurrencies)
		{
			<MudSelectItem Value="@currency.AlphaCode">@currency.Name (@currency.Symbol)</MudSelectItem>
		}
	</MudSelect>
}

@code {

	[Parameter]
	public UserPreferenceDto UserPreference { get; set; }

	[Parameter]
	public EventCallback<UserPreferenceDto> SaveUserPreference { get; set; }

	private async Task SavePreferredBaseCurrency(string selectedCurrency)
	{
		Console.WriteLine("Inside SavePreferredBaseCurrency method");
		try
		{
			UserPreference.BaseCurrency = selectedCurrency;
			await SaveUserPreference.InvokeAsync(UserPreference);
			Snackbar.Add("Base currency saved successfully.", Severity.Success);
			Logger.LogInformation("Base currency saved successfully.");
		}
		catch (Exception ex)
		{
			Snackbar.Add($"Error saving base currency: {ex.Message}", Severity.Error);
			Logger.LogError(ex, "Error saving base currency.");
		}
	}

}