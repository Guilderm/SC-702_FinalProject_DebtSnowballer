@using DebtSnowballer.Shared.DTOs
@using DebtSnowballer.Shared.Currency
<br/>
<br/>
@if (LoanDetail != null)
{
	<div class="modal" style="display: block">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">@(LoanDetail.Id == 0 ? "Add A Loan" : "Edit: ") @LoanDetail.Name</h5>
					<button type="button" class="btn-close" @onclick="OnCancel"></button>
				</div>
				<div class="modal-body">
					<EditForm Model="@LoanDetail" OnValidSubmit="SubmitDebtForm">
						<DataAnnotationsValidator/>
						<ValidationSummary/>

						<div class="form-group">
							<label for="LoanNickName">Loan NickName</label>
							<InputText id="LoanNickName" @bind-Value="LoanDetail.Name" class="form-control" placeholder="Loan NickName"/>
						</div>

						<div class="form-group">
							<label for="RemainingPrincipal">Remaining Principal</label>
							<InputNumber id="RemainingPrincipal" @bind-Value="LoanDetail.RemainingPrincipal" class="form-control" placeholder="Remaining Principal"/>
						</div>

						<div class="form-group">
							<label for="interestRate">Interest Rate</label>
							<InputNumber id="interestRate" @bind-Value="LoanDetail.AnnualInterestRate" class="form-control" placeholder="Interest Rate"/>
						</div>

						<div class="form-group">
							<label for="fees">BankFees</label>
							<InputNumber id="fees" @bind-Value="LoanDetail.BankFees" class="form-control" placeholder="BankFees"/>
						</div>

						<div class="form-group">
							<label for="monthlyPayment">Monthly Payment</label>
							<InputNumber id="monthlyPayment" @bind-Value="LoanDetail.ContractedMonthlyPayment" class="form-control" placeholder="Monthly Payment"/>
						</div>

						<div class="form-group">
							<label for="remainingTerm">Remaining Term In Months</label>
							<InputNumber id="remainingTerm" @bind-Value="LoanDetail.RemainingTermInMonths" class="form-control" placeholder="Remaining Term"/>
						</div>

						<div class="form-group">
							<label for="currency">Currency</label>
							<InputSelect id="currency" @bind-Value="LoanDetail.CurrencyCode" class="form-control">
								@foreach (CurrencyInfo currency in Currencies.SupportedCurrencies)
								{
									<option value="@currency.AlphaCode">@currency.Name (@currency.AlphaCode)</option>
								}
							</InputSelect>
						</div>

						<button type="submit" class="btn btn-primary">Save</button>
						<button type="button" class="btn btn-danger" @onclick="OnCancel">Cancel</button>
					</EditForm>
				</div>
			</div>
		</div>
	</div>
}

@code {

	private void UpdateCurrency(string newCurrency)
	{
		LoanDetail.CurrencyCode = newCurrency;
	}

	private void UpdateCurrency(ChangeEventArgs e)
	{
		LoanDetail.CurrencyCode = e.Value.ToString();
	}

	[Parameter]
	public LoanDetailDto LoanDetail { get; set; }

	[Parameter]
	public EventCallback<LoanDetailDto> OnSave { get; set; }

	[Parameter]
	public EventCallback OnCancel { get; set; }

	private async Task SubmitDebtForm()
	{
		await OnSave.InvokeAsync(LoanDetail);
	}

	private void UpdateCurrencyCode(string newCurrencyCode)
	{
		LoanDetail.CurrencyCode = newCurrencyCode;
	}

}