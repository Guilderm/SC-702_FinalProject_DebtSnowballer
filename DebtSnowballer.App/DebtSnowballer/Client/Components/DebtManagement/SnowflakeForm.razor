@using DebtSnowballer.Shared.DTOs
@using DebtSnowballer.Shared.Currency
<br/>
<br/>
@if (PlannedSnowflake != null)
{
	<div class="modal" style="display: block">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title">@(PlannedSnowflake.Id == 0 ? "Add A Snowflake" : "Edit: ") @PlannedSnowflake.Name</h5>
					<button type="button" class="btn-close" @onclick="OnCancel"></button>
				</div>
				<div class="modal-body">
					<EditForm Model="@PlannedSnowflake" OnValidSubmit="SubmitSnowflakeForm">
						<DataAnnotationsValidator/>
						<ValidationSummary/>

						<div class="form-group">
							<label for="NickName">Snowflake NickName</label>
							<InputText id="NickName" @bind-Value="PlannedSnowflake.Name" class="form-control" placeholder="Snowflake NickName" />
						</div>

						<div class="form-group">
							<label for="FrequencyInMonths">Frequency In Months</label>
							<InputNumber id="FrequencyInMonths" @bind-Value="PlannedSnowflake.FrequencyInMonths" class="form-control" placeholder="Frequency In Months"/>
						</div>

						<div class="form-group">
							<label for="Amount">Amount</label>
							<InputNumber id="Amount" @bind-Value="PlannedSnowflake.Amount" class="form-control" placeholder="Amount"/>
						</div>

						<div class="form-group">
							<label for="StartingAt">Starting At</label>
							<InputDate id="StartingAt" @bind-Value="PlannedSnowflake.StartingAt" class="form-control" placeholder="Starting At"/>
						</div>

						<div class="form-group">
							<label for="EndingAt">Ending At</label>
							<InputDate id="EndingAt" @bind-Value="PlannedSnowflake.EndingAt" class="form-control" placeholder="Ending At"/>
						</div>

						<div class="form-group">
							<label for="currency">Currency</label>
							<InputSelect id="currency" @bind-Value="PlannedSnowflake.CurrencyCode" class="form-control">
								@foreach (CurrencyInfo currency in Currencies.SupportedCurrencies)
								{
									<option value="@currency.AlphaCode">@currency.Name (@currency.AlphaCode)</option>
								}
							</InputSelect>
						</div>

						<button type="submit" class="btn btn-primary">Save</button>
						<button type="button" class="btn btn-danger" @onclick="OnCancel">Cancel</button>
					</EditForm>
				</div>
			</div>
		</div>
	</div>
}

@code {

	private void UpdateCurrency(string newCurrency)
	{
		PlannedSnowflake.CurrencyCode = newCurrency;
	}

	private void UpdateCurrency(ChangeEventArgs e)
	{
		PlannedSnowflake.CurrencyCode = e.Value.ToString();
	}

	[Parameter]
	public PlannedSnowflakeDto PlannedSnowflake { get; set; }

	[Parameter]
	public EventCallback<PlannedSnowflakeDto> OnSave { get; set; }

	[Parameter]
	public EventCallback OnCancel { get; set; }

	private async Task SubmitSnowflakeForm()
	{
		await OnSave.InvokeAsync(PlannedSnowflake);
	}

	private void UpdateCurrencyCode(string newCurrencyCode)
	{
		PlannedSnowflake.CurrencyCode = newCurrencyCode;
	}

}